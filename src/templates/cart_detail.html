{% extends 'base.html' %}
{% load static %}

{% block title %}Giỏ hàng{% endblock %}

{% block content %}

<h2>Giỏ hàng của bạn</h2>

{% if cart_items %}
<table border="1" cellpadding="10" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Sản phẩm</th>
            <th>Giá</th>
            <th>Số lượng</th>
            <th>Thành tiền</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for key, item in cart_items.items %}
        <tr>
            <td>
                {% if item.image %}
                    <img src="{{ item.image }}" width="60"><br>
                {% endif %}
                {{ item.name }}
            </td>
            <td>{{ item.price }} VNĐ</td>
            <td>
                <button onclick="updateQty('{{ key }}', 'decrease', csrfToken)">−</button>
                {{ item.quantity }}
                <button onclick="updateQty('{{ key }}', 'increase', csrfToken)">+</button>
            </td>
            <td>{{ item.total }} VNĐ</td>
            <td>
                <button onclick="removeFromCart('{{ key }}', csrfToken)">
                    Xóa
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>Tổng tiền: {{ total_price }} VNĐ</h3>

{% else %}
<p>Giỏ hàng trống.</p>
{% endif %}

{% if user.is_authenticated and cart_items %}
<form action="{% url 'create_order' %}" method="post">
    {% csrf_token %}
    <button type="submit">Đặt hàng</button>
</form>
{% elif not user.is_authenticated and cart_items %}
<p>
    <a href="{% url 'login' %}">Đăng nhập</a> để đặt hàng
</p>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    const csrfToken = '{{ csrf_token }}';
</script>
<script src="{% static 'js/cart.js' %}"></script>
{% endblock %}
