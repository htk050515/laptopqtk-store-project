{% extends 'base.html' %}

{% block title %}
Sản phẩm - {{ category.name }}
{% endblock %}

{% block content %}

<h2>Danh mục: {{ category.name }}</h2>

{% if products %}
    <div>
        {% for product in products %}
            <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                <h3>
    <a href="{% url 'product_detail' product.id %}">
        {{ product.name }}
    </a>
</h3>
                <p>Giá: {{ product.price }} VNĐ</p>

                <button class="add-to-cart-btn"
                        data-product-id="{{ product.id }}">
                    Thêm vào giỏ
                </button>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>Danh mục này chưa có sản phẩm.</p>
{% endif %}

<script>
document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', function () {
        const productId = this.dataset.productId;

        fetch(`/add-to-cart/${productId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
            }
        });
    });
});
</script>

{% endblock %}
